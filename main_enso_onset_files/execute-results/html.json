{
  "hash": "f5895b2fbf1621db153e50c69da0fd5f",
  "result": {
    "markdown": "---\ntitle: \"Data analysis\"\n---\n\n\n# Packages\n\n::: callout-warning\n# R packages instalation\n\nMake sure to have all packages bellow instaled before reproducing the analysis. To install these packages, one can use the function `install.packages()`. However, for installing the INLA package, we recommend following the instruction provided the [INLA website](https://www.r-inla.org/download-install){target=\"_blank\"}.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggdist)\nlibrary(rgdal)\nlibrary(spdep)\nlibrary(INLA)\nlibrary(distributional)\nlibrary(viridis)\nlibrary(lubridate)\nlibrary(lemon)\nlibrary(ggthemes)\nlibrary(cowplot)\n```\n:::\n\n\n\n\n# Load SBR data\n\nThe data on SBR occurrences in Southern Brazil can be loaded as shown in the code chunk below. Notice that we performed the transformation on the type date column types to `date` format. The column `season` was also transformed to type `character`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsbr_rep = read.csv(\".data/sbr_rep.csv\") %>% \n  #removing ther X column \n  dplyr::select(-X) %>% \n  \n  # tranforming the date columns to type date\n  mutate(start_season = as.Date(start_season),\n         start_date = as.Date(start_date),\n         date_report = as.Date(date_report)) %>% \n  # tranforming the seasons column to type character\n  mutate(season = as.character(season))\n```\n:::\n\n\n# Summaries SBR occurrence\n\nIn this part we extract some sumaries from the SBR data set\n\n### Number of reports\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsbr_rep %>% \n  summarise(n_reports = length(date_report))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"n_reports\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"2441\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Number of reports by state\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsbr_rep %>% \n  group_by(state) %>%\n  summarise(n_reports = length(date_report))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` ungrouping output (override with `.groups` argument)\n```\n:::\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"state\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n_reports\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"PR\",\"2\":\"1239\"},{\"1\":\"RS\",\"2\":\"969\"},{\"1\":\"SC\",\"2\":\"233\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsbr_rep %>%\n  group_by(state) %>% \n  summarise(length(unique(location)))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` ungrouping output (override with `.groups` argument)\n```\n:::\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"state\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"length(unique(location))\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"PR\",\"2\":\"278\"},{\"1\":\"RS\",\"2\":\"269\"},{\"1\":\"SC\",\"2\":\"87\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Number of reports by season\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsbr_rep %>% \n  group_by(season) %>%\n  summarise(n_reports = length(date_report)) %>% \n  arrange(n_reports)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` ungrouping output (override with `.groups` argument)\n```\n:::\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"season\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"n_reports\"],\"name\":[2],\"type\":[\"int\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"2012\",\"2\":\"27\"},{\"1\":\"2014\",\"2\":\"60\"},{\"1\":\"2020\",\"2\":\"70\"},{\"1\":\"2013\",\"2\":\"105\"},{\"1\":\"2019\",\"2\":\"119\"},{\"1\":\"2016\",\"2\":\"121\"},{\"1\":\"2021\",\"2\":\"121\"},{\"1\":\"2017\",\"2\":\"124\"},{\"1\":\"2018\",\"2\":\"161\"},{\"1\":\"2011\",\"2\":\"168\"},{\"1\":\"2015\",\"2\":\"178\"},{\"1\":\"2010\",\"2\":\"185\"},{\"1\":\"2008\",\"2\":\"188\"},{\"1\":\"2005\",\"2\":\"195\"},{\"1\":\"2007\",\"2\":\"195\"},{\"1\":\"2009\",\"2\":\"209\"},{\"1\":\"2006\",\"2\":\"215\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### Earliests reports per season\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsbr_rep %>% \n  group_by(season) %>% \n  filter(date_report == min(date_report)) %>% \n  arrange(days_sep15)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 22 x 15\n# Groups:   season [17]\n   start_date season state location date_report Phen_state month  days   lat\n   <date>     <chr>  <chr> <chr>    <date>      <chr>      <chr> <int> <dbl>\n 1 2009-10-07 2010   PR    Londrina 2009-09-29  Vn         Sep       8 -23.3\n 2 2018-09-07 2019   PR    Marecha~ 2018-10-31  R1         Oct      54 -24.6\n 3 2012-08-07 2013   SC    São Car~ 2012-11-02  R2         Nov      87 -27.1\n 4 2015-09-21 2016   PR    Ponta G~ 2015-11-07  R1         Nov      47 -25.1\n 5 2005-08-07 2006   PR    Cafelân~ 2005-11-09  R3         Nov      94 -24.6\n 6 2005-09-07 2006   PR    Campo M~ 2005-11-09  R2         Nov      63 -24.0\n 7 2005-11-07 2006   PR    Cruzeir~ 2005-11-09  R4         Nov       2 -23.8\n 8 2005-11-07 2006   PR    Mariluz  2005-11-09  R5         Nov       2 -24.0\n 9 2006-11-07 2007   PR    Marecha~ 2006-11-14  V3         Nov       7 -24.6\n10 2016-09-21 2017   PR    Boa Esp~ 2016-11-16  R3         Nov      56 -24.2\n# ... with 12 more rows, and 6 more variables: lon <dbl>, Phen_state_int <int>,\n#   start_season <date>, days_sep15 <int>, week <int>, region <chr>\n```\n:::\n:::\n\n\n### Distribution of dates of SBR occurrences\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsbr_rep %>%\n  mutate(year_s = as.numeric(season)-2000,\n         year_date = year(date_report),\n         year_new = year_date-year_s,\n         month2 = month(date_report),\n         day = day(date_report)) %>%\n  unite(date_altered, year_new, month2, day, sep =\"-\") %>%\n  mutate(date_altered = as.Date(date_altered)) %>%\n  ggplot(aes(y= season, x = days)) +\n  stat_histinterval(aes(fill = stat(pdf)),\n                    slab_type = \"histogram\",\n                    geom = \"slab\",\n                    breaks = 20\n                    )+\n  geom_point(shape = \"|\", size =2)+\n  theme_half_open()+\n  background_grid(major = \"y\")+\n  scale_x_continuous(limits = c(0,215),\n                     labels = format(as.Date(c(seq(0,215, by = 50)+as.Date(\"2000-09-15\")),\n                               format = \"%d-%b-%Y\"),\"%b %d\")\n                     )+\n  scale_fill_gradient(low =\"#1e88e5ff\", high = \"#ff0d57ff\")+\n  labs(x = \"Dates\",\n       y = \"Season\")+\n \n  theme(axis.text.x = element_text(),\n        strip.background = element_blank(),\n        legend.position = \"none\"\n        )\n```\n\n::: {.cell-output-display}\n![](main_enso_onset_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\".figs/histogram_dates.png\", dpi = 600, height = 10, width = 6)\n```\n:::\n\n\n# ENSO\n\n## Load ENSO data\n\nHere we load the data on Oceanic Niño Index (ONI)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nensodata2 =read.csv( \".data/enso_tidy.csv\") %>% \n  #removing ther X column \n  dplyr::select(-X) %>% \n  # reodering the enso column as \"Neutral\" > \"El Niño\" > \"La Niña\"\n  mutate(enso = factor(enso, c(\"Neutral\",\"El Niño\", \"La Niña\"))) %>% \n  # tranforming the seasons column to type character\n  mutate(season = as.character(season))\n```\n:::\n\n\n## Exploring ENSO data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nONI_trimesters = ensodata2 %>% \n  pivot_longer(1:12,\n               names_to = \"trimester\",\n               values_to = \"ONI\") %>% \n  mutate(trimester = factor(trimester,\n                            levels =c(\"DJF\",\"JFM\",\"FMA\",\"MAM\",\"AMJ\",\"MJJ\",\"JJA\",\"JAS\",\"ASO\",\"SON\",\"OND\",\"NDJ\" ) ))\nONI_trimesters\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"season\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"enso\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"trimester\"],\"name\":[3],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"ONI\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"DJF\",\"4\":\"0.4\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"JFM\",\"4\":\"0.3\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"FMA\",\"4\":\"0.2\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"MAM\",\"4\":\"0.2\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"AMJ\",\"4\":\"0.2\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"MJJ\",\"4\":\"0.3\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"JJA\",\"4\":\"0.5\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"JAS\",\"4\":\"0.6\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"ASO\",\"4\":\"0.7\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"SON\",\"4\":\"0.7\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"OND\",\"4\":\"0.7\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"NDJ\",\"4\":\"0.7\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"DJF\",\"4\":\"0.6\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"0.6\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"FMA\",\"4\":\"0.4\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"MAM\",\"4\":\"0.4\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"AMJ\",\"4\":\"0.3\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"0.1\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"JJA\",\"4\":\"-0.1\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"JAS\",\"4\":\"-0.1\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"ASO\",\"4\":\"-0.1\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"SON\",\"4\":\"-0.3\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"-0.6\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"NDJ\",\"4\":\"-0.8\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"DJF\",\"4\":\"-0.9\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"JFM\",\"4\":\"-0.8\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"FMA\",\"4\":\"-0.6\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"MAM\",\"4\":\"-0.4\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"AMJ\",\"4\":\"-0.1\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"MJJ\",\"4\":\"0.0\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"JJA\",\"4\":\"0.1\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"JAS\",\"4\":\"0.3\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"ASO\",\"4\":\"0.5\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"SON\",\"4\":\"0.8\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"OND\",\"4\":\"0.9\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"NDJ\",\"4\":\"0.9\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"DJF\",\"4\":\"0.7\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"JFM\",\"4\":\"0.2\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"FMA\",\"4\":\"-0.1\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"MAM\",\"4\":\"-0.3\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"AMJ\",\"4\":\"-0.4\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"MJJ\",\"4\":\"-0.5\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"JJA\",\"4\":\"-0.6\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"JAS\",\"4\":\"-0.8\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"ASO\",\"4\":\"-1.1\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"SON\",\"4\":\"-1.3\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"OND\",\"4\":\"-1.5\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"NDJ\",\"4\":\"-1.6\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"DJF\",\"4\":\"-1.6\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"-1.5\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"FMA\",\"4\":\"-1.3\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"MAM\",\"4\":\"-1.0\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"AMJ\",\"4\":\"-0.8\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"-0.6\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"JJA\",\"4\":\"-0.4\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"JAS\",\"4\":\"-0.2\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"ASO\",\"4\":\"-0.2\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"SON\",\"4\":\"-0.4\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"-0.6\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"NDJ\",\"4\":\"-0.7\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"DJF\",\"4\":\"-0.8\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"JFM\",\"4\":\"-0.8\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"FMA\",\"4\":\"-0.6\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"MAM\",\"4\":\"-0.3\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"AMJ\",\"4\":\"0.0\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"MJJ\",\"4\":\"0.3\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"JJA\",\"4\":\"0.5\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"JAS\",\"4\":\"0.6\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"ASO\",\"4\":\"0.7\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"SON\",\"4\":\"1.0\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"OND\",\"4\":\"1.4\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"NDJ\",\"4\":\"1.6\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"DJF\",\"4\":\"1.5\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"JFM\",\"4\":\"1.2\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"FMA\",\"4\":\"0.8\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"MAM\",\"4\":\"0.4\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"AMJ\",\"4\":\"-0.2\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"MJJ\",\"4\":\"-0.7\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"JJA\",\"4\":\"-1.0\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"JAS\",\"4\":\"-1.3\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"ASO\",\"4\":\"-1.6\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"SON\",\"4\":\"-1.6\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"OND\",\"4\":\"-1.6\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"NDJ\",\"4\":\"-1.6\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"DJF\",\"4\":\"-1.4\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"JFM\",\"4\":\"-1.2\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"FMA\",\"4\":\"-0.9\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"MAM\",\"4\":\"-0.7\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"AMJ\",\"4\":\"-0.6\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"MJJ\",\"4\":\"-0.4\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"JJA\",\"4\":\"-0.5\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"JAS\",\"4\":\"-0.6\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"ASO\",\"4\":\"-0.8\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"SON\",\"4\":\"-1.0\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"OND\",\"4\":\"-1.1\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"NDJ\",\"4\":\"-1.0\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"DJF\",\"4\":\"-0.9\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"-0.7\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"FMA\",\"4\":\"-0.6\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"MAM\",\"4\":\"-0.5\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"AMJ\",\"4\":\"-0.3\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"0.0\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"JJA\",\"4\":\"0.2\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"JAS\",\"4\":\"0.4\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"ASO\",\"4\":\"0.4\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"SON\",\"4\":\"0.3\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"0.1\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"NDJ\",\"4\":\"-0.2\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"DJF\",\"4\":\"-0.4\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"-0.4\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"FMA\",\"4\":\"-0.3\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"MAM\",\"4\":\"-0.3\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"AMJ\",\"4\":\"-0.4\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"-0.4\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"JJA\",\"4\":\"-0.4\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"JAS\",\"4\":\"-0.3\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"ASO\",\"4\":\"-0.3\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"SON\",\"4\":\"-0.2\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"-0.2\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"NDJ\",\"4\":\"-0.3\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"DJF\",\"4\":\"-0.4\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"-0.5\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"FMA\",\"4\":\"-0.3\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"MAM\",\"4\":\"0.0\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"AMJ\",\"4\":\"0.2\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"0.2\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"JJA\",\"4\":\"0.0\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"JAS\",\"4\":\"0.1\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"ASO\",\"4\":\"0.2\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"SON\",\"4\":\"0.5\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"0.6\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"NDJ\",\"4\":\"0.7\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"DJF\",\"4\":\"0.5\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"JFM\",\"4\":\"0.5\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"FMA\",\"4\":\"0.5\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"MAM\",\"4\":\"0.7\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"AMJ\",\"4\":\"0.9\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"MJJ\",\"4\":\"1.2\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"JJA\",\"4\":\"1.5\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"JAS\",\"4\":\"1.9\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"ASO\",\"4\":\"2.2\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"SON\",\"4\":\"2.4\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"OND\",\"4\":\"2.6\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"NDJ\",\"4\":\"2.6\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"DJF\",\"4\":\"2.5\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"2.1\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"FMA\",\"4\":\"1.6\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"MAM\",\"4\":\"0.9\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"AMJ\",\"4\":\"0.4\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"-0.1\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"JJA\",\"4\":\"-0.4\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"JAS\",\"4\":\"-0.5\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"ASO\",\"4\":\"-0.6\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"SON\",\"4\":\"-0.7\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"-0.7\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"NDJ\",\"4\":\"-0.6\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"DJF\",\"4\":\"-0.3\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"JFM\",\"4\":\"-0.2\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"FMA\",\"4\":\"0.1\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"MAM\",\"4\":\"0.2\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"AMJ\",\"4\":\"0.3\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"MJJ\",\"4\":\"0.3\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"JJA\",\"4\":\"0.1\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"JAS\",\"4\":\"-0.1\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"ASO\",\"4\":\"-0.4\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"SON\",\"4\":\"-0.7\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"OND\",\"4\":\"-0.8\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"NDJ\",\"4\":\"-1.0\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"DJF\",\"4\":\"-0.9\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"JFM\",\"4\":\"-0.9\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"FMA\",\"4\":\"-0.7\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"MAM\",\"4\":\"-0.5\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"AMJ\",\"4\":\"-0.2\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"MJJ\",\"4\":\"0.0\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"JJA\",\"4\":\"0.1\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"JAS\",\"4\":\"0.2\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"ASO\",\"4\":\"0.5\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"SON\",\"4\":\"0.8\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"OND\",\"4\":\"0.9\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"NDJ\",\"4\":\"0.8\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"DJF\",\"4\":\"0.7\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"0.7\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"FMA\",\"4\":\"0.7\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"MAM\",\"4\":\"0.7\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"AMJ\",\"4\":\"0.5\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"0.5\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"JJA\",\"4\":\"0.3\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"JAS\",\"4\":\"0.1\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"ASO\",\"4\":\"0.2\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"SON\",\"4\":\"0.3\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"0.5\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"NDJ\",\"4\":\"0.5\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"DJF\",\"4\":\"0.5\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"JFM\",\"4\":\"0.5\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"FMA\",\"4\":\"0.4\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"MAM\",\"4\":\"0.2\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"AMJ\",\"4\":\"-0.1\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"MJJ\",\"4\":\"-0.3\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"JJA\",\"4\":\"-0.4\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"JAS\",\"4\":\"-0.6\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"ASO\",\"4\":\"-0.9\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"SON\",\"4\":\"-1.2\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"OND\",\"4\":\"-1.3\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"NDJ\",\"4\":\"-1.2\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n### ONI over time for each year (2004 to 2020)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nONI_trimesters %>% \n  ggplot(aes(trimester, ONI, group = season, color = enso))+\n  geom_hline(yintercept = 0, color = \"gray\")+\n  scale_color_colorblind()+\n  geom_vline(xintercept = \"OND\", color = \"gray\")+\nstat_summary(fun.y=sum, geom=\"line\")+\n  theme_half_open()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: `fun.y` is deprecated. Use `fun` instead.\n```\n:::\n\n::: {.cell-output-display}\n![](main_enso_onset_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n### ONI for selected trimesters\n\n- January, February, and March (ONI~JFM~, prior to the growing season);\n- May, June, and July (ONI~MJJ~, prior to the growing season);\n- October, November, and December (ONI~OND~, within the growing season)\n\n\n::: {.cell}\n\n```{.r .cell-code}\nONI_trimesters %>%  \n  filter(trimester %in% c(\"JFM\", \"MJJ\", \"OND\")) %>% \n  ggplot(aes( trimester, ONI, group = trimester, color = ONI))+\n  geom_hline(yintercept = 0, color = \"gray\")+\n  geom_errorbar(aes(ymin=0, ymax  = ONI), width = 0, color = \"black\")+\n  geom_line(aes(group = season), color=\"black\")+\n  geom_point(size = 3)+\n   \n  geom_segment(x = 2.7, y = 2.8, xend = 3.6, yend =2.8,\n               color = \"black\",\n               size =1,\n               arrow = arrow(length = unit(0.09, \"npc\")))+\n  annotate(geom =\"text\", x = 2.5, y =3.25 ,label = \"Growing season\", size = 2.5)+\n  scale_y_continuous(breaks = seq(-1.6, 2.4, by  = 0.8))+\n  scale_color_viridis()+\n  theme_half_open(font_size = 12)+\n  facet_rep_wrap(~season)+\n  labs(x = \"Trimester\",\n       y = \"Oceanic Niño Index (°C)\",\n       color = \"ENSO phase (OND)\")+\n  theme(strip.background = element_blank(),\n        \n        legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](main_enso_onset_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\".figs/ONItrimeter.png\", dpi = 600, height = 6.5, width = 9, bg = \"white\")\n```\n:::\n\n\n\n### ONI distribution per trimester\n\n- ONI values arranged from lowest to highest\n\n\n::: {.cell}\n\n```{.r .cell-code}\nONI_trimesters%>% \n  filter(trimester %in% c(\"JFM\", \"MJJ\", \"OND\")) %>% \n  arrange(ONI)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"season\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"enso\"],\"name\":[2],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"trimester\"],\"name\":[3],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"ONI\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"OND\",\"4\":\"-1.6\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"OND\",\"4\":\"-1.5\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"-1.5\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"OND\",\"4\":\"-1.3\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"JFM\",\"4\":\"-1.2\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"OND\",\"4\":\"-1.1\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"JFM\",\"4\":\"-0.9\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"JFM\",\"4\":\"-0.8\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"JFM\",\"4\":\"-0.8\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"OND\",\"4\":\"-0.8\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"MJJ\",\"4\":\"-0.7\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"-0.7\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"-0.7\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"-0.6\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"-0.6\"},{\"1\":\"2009\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"-0.6\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"MJJ\",\"4\":\"-0.5\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"-0.5\"},{\"1\":\"2012\",\"2\":\"La Niña\",\"3\":\"MJJ\",\"4\":\"-0.4\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"-0.4\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"-0.4\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"MJJ\",\"4\":\"-0.3\"},{\"1\":\"2014\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"-0.2\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"JFM\",\"4\":\"-0.2\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"-0.1\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"MJJ\",\"4\":\"0.0\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"0.0\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"MJJ\",\"4\":\"0.0\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"0.1\"},{\"1\":\"2013\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"0.1\"},{\"1\":\"2008\",\"2\":\"La Niña\",\"3\":\"JFM\",\"4\":\"0.2\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"0.2\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"JFM\",\"4\":\"0.3\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"MJJ\",\"4\":\"0.3\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"MJJ\",\"4\":\"0.3\"},{\"1\":\"2018\",\"2\":\"La Niña\",\"3\":\"MJJ\",\"4\":\"0.3\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"JFM\",\"4\":\"0.5\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"MJJ\",\"4\":\"0.5\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"0.5\"},{\"1\":\"2021\",\"2\":\"La Niña\",\"3\":\"JFM\",\"4\":\"0.5\"},{\"1\":\"2006\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"0.6\"},{\"1\":\"2015\",\"2\":\"Neutral\",\"3\":\"OND\",\"4\":\"0.6\"},{\"1\":\"2005\",\"2\":\"El Niño\",\"3\":\"OND\",\"4\":\"0.7\"},{\"1\":\"2020\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"0.7\"},{\"1\":\"2007\",\"2\":\"El Niño\",\"3\":\"OND\",\"4\":\"0.9\"},{\"1\":\"2019\",\"2\":\"El Niño\",\"3\":\"OND\",\"4\":\"0.9\"},{\"1\":\"2011\",\"2\":\"La Niña\",\"3\":\"JFM\",\"4\":\"1.2\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"MJJ\",\"4\":\"1.2\"},{\"1\":\"2010\",\"2\":\"El Niño\",\"3\":\"OND\",\"4\":\"1.4\"},{\"1\":\"2017\",\"2\":\"Neutral\",\"3\":\"JFM\",\"4\":\"2.1\"},{\"1\":\"2016\",\"2\":\"El Niño\",\"3\":\"OND\",\"4\":\"2.6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n- Boxplot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nONI_trimesters%>% \n  filter(trimester %in% c(\"JFM\", \"MJJ\", \"OND\")) %>% \n  ggplot(aes(trimester, ONI, color = ONI))+\n  geom_hline(yintercept = 0, linetype = 2, color=\"gray\")+\n  geom_boxplot(width = 0.2, alpha =0)+\n  geom_jitter(width = 0.1, size =2)+\n  scale_color_viridis()+\n  theme_half_open()+\n  labs(x = \"Trimester\",\n       y = \"Oceanic Niño index (ONI) (°C)\")+\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](main_enso_onset_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggsave(\".figs/ONIbox_plot.png\", dpi = 600, height = 4, width = 4, bg = \"white\")\n```\n:::\n\n\n- Summaries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nONI_trimesters%>% \n  filter(trimester %in% c(\"JFM\", \"MJJ\", \"OND\")) %>% \n  group_by(trimester) %>% \n  summarise(ONI_mean = round(mean(ONI),2),\n            ONI_sd = round(sd(ONI),2),\n            median(ONI),\n            min(ONI),\n            max(ONI))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` ungrouping output (override with `.groups` argument)\n```\n:::\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"trimester\"],\"name\":[1],\"type\":[\"fct\"],\"align\":[\"left\"]},{\"label\":[\"ONI_mean\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"ONI_sd\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"median(ONI)\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"min(ONI)\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"max(ONI)\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"JFM\",\"2\":\"-0.05\",\"3\":\"0.94\",\"4\":\"-0.2\",\"5\":\"-1.5\",\"6\":\"2.1\"},{\"1\":\"MJJ\",\"2\":\"-0.01\",\"3\":\"0.47\",\"4\":\"0.0\",\"5\":\"-0.7\",\"6\":\"1.2\"},{\"1\":\"OND\",\"2\":\"-0.04\",\"3\":\"1.15\",\"4\":\"-0.2\",\"5\":\"-1.6\",\"6\":\"2.6\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n\n\n# Modeling the effect of ONI\n\n## Cox Proportional Hazards Model\n\n### Data preparation\n\n#### SBR data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsbr_rep_count = sbr_rep %>%\n  mutate(count =  1) %>% \n  mutate(season = as.character(season))\n```\n:::\n\n\n#### Loading shapefiles\n\nShape files will be used for the obtaining the spatial structure of municipalities\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshape_sul= readOGR(\".shapefiles/BR_MUN1997_S_region\",\"BR_MUN1997_S_region\" )\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOGR data source with driver: ESRI Shapefile \nSource: \"G:\\.shortcut-targets-by-id\\1dhaIjvNvB3338uiITeAH9RsOtKndESF7\\Kaique-Alves\\SBR-soybean\\02 - SBR_spatiotemporal-description\\v2\\01 - repository\\.shapefiles\\BR_MUN1997_S_region\", layer: \"BR_MUN1997_S_region\"\nwith 1159 features\nIt has 19 fields\n```\n:::\n\n```{.r .cell-code}\nshape_sul@data$id = rownames(shape_sul@data)\nsul_points = fortify(shape_sul)\nsul_df =plyr::join(sul_points, shape_sul@data, by=\"id\")\n```\n:::\n\n\nObtaining the names of the municipalities from the shape files (formatting in the municipalies names in SBR dataset and shape files were different).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nIDs = unique(sul_df$id)\nlocation2 = numeric(length(sbr_rep_count$lat))\nfor(i in 1:length(IDs)){\n qqq = sul_df %>%\n  filter(id == IDs[i])\n\ncity = as.character(unique(qqq$MUNIC_PIO))\n\n for(j in 1:length(sbr_rep_count$lat)){\n    pip = point.in.polygon(point.x = sbr_rep_count$lon[j],\n                           point.y = sbr_rep_count$lat[j],\n                           pol.x = qqq$long,\n                           pol.y = qqq$lat)\n\n      if(pip > 0){location2[j] = city}\n\n }\n}\nsbr_rep_count_new = sbr_rep_count %>%\n  mutate(MUNIC_PIO = location2)\n```\n:::\n\n\n#### INLA Data\n\nCreating the data set with new municipalities names\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmonths = c(\"Sep\", \"Oct\", \"Nov\", \"Dec\", \"Jan\", \"Feb\", \"Mar\",\"Apr\",\"May\")\ninla_data_geral = sbr_rep_count %>%\n  mutate(month = factor(month, levels = months)) %>% \n  full_join(sbr_rep_count_new %>% mutate(month = factor(month, levels = months))) %>% \n  full_join(data.frame(MUNIC_PIO = unique(sbr_rep_count_new$MUNIC_PIO)) %>% \n  mutate(S = 1:length(MUNIC_PIO)))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining, by = c(\"start_date\", \"season\", \"state\", \"location\", \"date_report\", \"Phen_state\", \"month\", \"days\", \"lat\", \"lon\", \"Phen_state_int\", \"start_season\", \"days_sep15\", \"week\", \"region\", \"count\")\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining, by = \"MUNIC_PIO\"\n```\n:::\n:::\n\n\n#### adding ONI values\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninla_data_enso = inla_data_geral %>% \n  full_join(ensodata2)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining, by = \"season\"\n```\n:::\n:::\n\n\n\n#### Neighbour by distance 200 km\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsul_locations = unique(sbr_rep_count_new$MUNIC_PIO)\n\nshape_sul_sub = subset(shape_sul, shape_sul$MUNIC_PIO%in%sul_locations )\n\ncoords_pr = coords <- coordinates(shape_sul_sub)\n\nIDs_pr <- row.names(as(shape_sul_sub, \"data.frame\"))\n\nlong = coords_pr[,1]\nlat = coords_pr[,2]\nxy <- data.frame(ID = 1:(length(lat)), long, lat)\n\ncoordinates(xy) <- c(\"long\", \"lat\")\nproj4string(xy) <- CRS(\"+init=epsg:4326\")\n\nres <- spTransform(xy, CRS(\"+proj=utm +zone=22 +south ellps=WGS84\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in showSRID(uprojargs, format = \"PROJ\", multiline = \"NO\"): Discarded\ndatum Unknown based on WGS84 ellipsoid in CRS definition\n```\n:::\n\n```{.r .cell-code}\ncoords_grid = as.data.frame(res)\ncoords2 = as.matrix(coords_grid[,2:3])\ncolnames(coords2) <- c(\"x1\",\"x2\")\n\n\ndnear_dist_200 = dnearneigh(coords2, 0,200000, row.names=IDs_pr)\n\n# nb2INLA(\"./models/grid200.graph\",dnear_dist_200)\nW.pr_dist200 = inla.read.graph(\"./.models/grid200.graph\")\nplot(shape_sul_sub)\nplot(dnear_dist_200,coordinates(shape_sul_sub),col =\"red\", add = T)\n```\n\n::: {.cell-output-display}\n![](main_enso_onset_files/figure-html/unnamed-chunk-44-1.png){width=672}\n:::\n:::\n\n\n\n### Model fitting\n\n-  PC priors\n\n\n::: {.cell}\n\n```{.r .cell-code}\nu <- 0.2/0.31\nalpha <- 0.01\nphi.u <- 0.5\nphi.alpha <- 2/3\n```\n:::\n\n\n#### Model for OND\n\n\n::: {.cell}\n\n```{.r .cell-code}\nform_surv_ONI1 = inla.surv(days, count) ~ 1 + OND + \n  f(season, model = \"iid\", hyper = list(prec = list(param = c(0.001,0.001))))+\n  f(S, model = \"bym2\", graph = W.pr_dist200,\n    hyper = list(prec = list(param = c(0.001, 0.001)), \n                 phi = list(prior = \"pc\", \n                            param = c(phi.u, phi.alpha),\n                            initial = -3)))\n\n\nsurv_fit_ONI1 = inla(form_surv_ONI1,\n                        data = inla_data_enso,\n                        family = \"coxph\",\n                     control.fixed=list(prec.intercept=1),\n                      control.hazard = list(hyper = list(prec = list(param = c(0.001, 0.001)))),\n                        control.compute=list(dic=TRUE,\n                                             cpo=TRUE,\n                                             waic=TRUE,\n                                             openmp.strategy=\"huge\"))\n\n# saveRDS(surv_fit_ONI1, \"./.models/model_oni1.RDS\")\n```\n:::\n\n\n\n\n##### Model summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(surv_fit_ONI1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\n   c(\"inla(formula = cph$formula, family = cph$family, contrasts = \n   contrasts, \", \" data = c(as.list(cph$data), cph$data.list), quantiles = \n   quantiles, \", \" E = cph$E, offset = offset, scale = scale, weights = \n   weights, \", \" Ntrials = NULL, strata = NULL, verbose = verbose, lincomb \n   = lincomb, \", \" selection = selection, control.compute = \n   control.compute, \", \" control.predictor = control.predictor, \n   control.family = control.family, \", \" control.inla = control.inla, \n   control.results = control.results, \", \" control.fixed = control.fixed, \n   control.mode = control.mode, \", \" control.expert = control.expert, \n   control.hazard = control.hazard, \", \" control.lincomb = \n   control.lincomb, control.update = control.update, \", \" control.pardiso \n   = control.pardiso, only.hyperparam = only.hyperparam, \", \" inla.call = \n   inla.call, inla.arg = inla.arg, num.threads = num.threads, \", \" \n   blas.num.threads = blas.num.threads, keep = keep, working.directory = \n   working.directory, \", \" silent = silent, debug = debug)\") \nTime used:\n    Pre = 37.6, Running = 79.7, Post = 1.31, Total = 119 \nFixed effects:\n              mean    sd 0.025quant 0.5quant 0.975quant   mode kld\n(Intercept) -3.788 0.136     -4.052   -3.790     -3.516 -3.792   0\nOND          0.323 0.097      0.130    0.323      0.517  0.323   0\n\nRandom effects:\n  Name\t  Model\n    season IID model\n   S BYM2 model\n   baseline.hazard RW1 model\n\nModel hyperparameters:\n                                  mean       sd 0.025quant 0.5quant 0.975quant\nPrecision for season          5.80e+00 2.26e+00   2.43e+00 5.47e+00   1.12e+01\nPrecision for S               2.16e+09 6.36e+10   4.28e+06 1.11e+08   1.22e+10\nPhi for S                     2.83e-01 2.50e-01   9.00e-03 2.03e-01   8.71e-01\nPrecision for baseline.hazard 2.98e+01 1.19e+01   1.22e+01 2.80e+01   5.82e+01\n                                  mode\nPrecision for season          4.80e+00\nPrecision for S               7.94e+06\nPhi for S                     1.50e-02\nPrecision for baseline.hazard 2.44e+01\n\nExpected number of effective parameters(stdev): 28.52(0.512)\nNumber of equivalent replicates : 654.35 \n\nDeviance Information Criterion (DIC) ...............: 14792.55\nDeviance Information Criterion (DIC, saturated) ....: 9910.54\nEffective number of parameters .....................: 28.82\n\nWatanabe-Akaike information criterion (WAIC) ...: 14791.26\nEffective number of parameters .................: 27.33\n\nMarginal log-Likelihood:  -6871.11 \nCPO and PIT are computed\n\nPosterior marginals for the linear predictor and\n the fitted values are computed\n```\n:::\n:::\n\n\n##### Parameters\n\n###### Posterior distribution summaries\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar_summ_ond = data.frame(surv_fit_ONI1$summary.fixed %>% \n             dplyr::select(`mean`,`0.5quant`,`mode`,`sd`) %>% \n             dplyr::rename(median = `0.5quant`))\n```\n:::\n\n\n###### HPD intervas\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# intercept(beta_0)\npar_hpd_ond=\nbind_rows(\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI1$marginals.fixed$`(Intercept)`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI1$marginals.fixed$`(Intercept)`)[2],\n           row.names = \"(Intercept)\"),\n# slope (ONI)\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI1$marginals.fixed$OND)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI1$marginals.fixed$OND)[2],\n           row.names = \"OND\") \n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npar_ond = bind_cols(par_summ_ond ,par_hpd_ond)\npar_ond\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"mean\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"median\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"mode\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sd\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"HPD_lower\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"HPD_upper\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"-3.7884586\",\"2\":\"-3.7898917\",\"3\":\"-3.7921767\",\"4\":\"0.13584244\",\"5\":\"-4.0557717\",\"6\":\"-3.5203596\",\"_rn_\":\"(Intercept)\"},{\"1\":\"0.3231754\",\"2\":\"0.3229977\",\"3\":\"0.3226898\",\"4\":\"0.09746967\",\"5\":\"0.1294629\",\"6\":\"0.5162915\",\"_rn_\":\"OND\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n##### Hyperparameters\n\n###### Posterior distribution summaries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhyper_summ_ond = round(surv_fit_ONI1$summary.hyperpar, 3) %>% \n  dplyr::select(`mean`,`0.5quant`,`mode`,`sd`) %>% \n  dplyr::rename(median = `0.5quant`)\n```\n:::\n\n\n###### HPD intervas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhyper_hpd_ond = \nbind_rows(\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI1$marginals.hyperpar$`Precision for season`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI1$marginals.hyperpar$`Precision for season`)[2],\n           row.names = \"Precision for season\"),\n\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI1$marginals.hyperpar$`Precision for S`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI1$marginals.hyperpar$`Precision for S`)[2],\n           row.names = \"Precision for S\"),\n\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI1$marginals.hyperpar$`Phi for S`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI1$marginals.hyperpar$`Phi for S`)[2],\n           row.names = \"Phi for S\"),\n\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI1$marginals.hyperpar$`Precision for baseline.hazard`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI1$marginals.hyperpar$`Precision for baseline.hazard`)[2],\n           row.names = \"Precision for baseline.hazard\")\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhyper_ond = bind_cols(hyper_summ_ond,hyper_hpd_ond)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbind_rows(par_ond,hyper_ond) %>% \n  rownames_to_column(\"parameter\") \n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"parameter\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"mean\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"median\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"mode\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sd\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"HPD_lower\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"HPD_upper\"],\"name\":[7],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"(Intercept)\",\"2\":\"-3.788459e+00\",\"3\":\"-3.789892e+00\",\"4\":\"-3.792177e+00\",\"5\":\"1.358424e-01\",\"6\":\"-4.055772e+00\",\"7\":\"-3.520360e+00\"},{\"1\":\"OND\",\"2\":\"3.231754e-01\",\"3\":\"3.229977e-01\",\"4\":\"3.226898e-01\",\"5\":\"9.746967e-02\",\"6\":\"1.294629e-01\",\"7\":\"5.162915e-01\"},{\"1\":\"Precision for season\",\"2\":\"5.803000e+00\",\"3\":\"5.467000e+00\",\"4\":\"4.796000e+00\",\"5\":\"2.261000e+00\",\"6\":\"1.991769e+00\",\"7\":\"1.024534e+01\"},{\"1\":\"Precision for S\",\"2\":\"2.164581e+09\",\"3\":\"1.110489e+08\",\"4\":\"7.939607e+06\",\"5\":\"6.364746e+10\",\"6\":\"1.884410e+03\",\"7\":\"2.297568e+11\"},{\"1\":\"Phi for S\",\"2\":\"2.830000e-01\",\"3\":\"2.030000e-01\",\"4\":\"1.500000e-02\",\"5\":\"2.500000e-01\",\"6\":\"3.019836e-04\",\"7\":\"7.981945e-01\"},{\"1\":\"Precision for baseline.hazard\",\"2\":\"2.978700e+01\",\"3\":\"2.799300e+01\",\"4\":\"2.436800e+01\",\"5\":\"1.190000e+01\",\"6\":\"9.832380e+00\",\"7\":\"5.313925e+01\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n#### Model for MJJ\n\n\n::: {.cell}\n\n```{.r .cell-code}\nform_surv_ONI2 = inla.surv(days, count) ~ 1 + MJJ +\n  f(season, model = \"iid\", hyper = list(prec = list(param = c(0.001,0.001))))+\n  f(S, model = \"bym2\", graph = W.pr_dist200,\n    hyper = list(prec = list(param = c(0.001, 0.001)), \n                 phi = list(prior = \"pc\", \n                            param = c(phi.u, phi.alpha),\n                            initial = -3)))\n\n\nsurv_fit_ONI2 = inla(form_surv_ONI2,\n                        data = inla_data_enso,\n                        family = \"coxph\",\n                     control.fixed=list(prec.intercept=1),\n                     control.hazard = list(hyper = list(prec = list(param = c(0.001, 0.001)))),\n                        control.compute=list(dic=TRUE,\n                                             cpo=TRUE,\n                                             waic=TRUE,\n                                             openmp.strategy=\"huge\"))\n\n# saveRDS(surv_fit_ONI2, \"./.models/model_oni2.RDS\")\n```\n:::\n\n\n\n\n##### Model summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(surv_fit_ONI2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\n   c(\"inla(formula = cph$formula, family = cph$family, contrasts = \n   contrasts, \", \" data = c(as.list(cph$data), cph$data.list), quantiles = \n   quantiles, \", \" E = cph$E, offset = offset, scale = scale, weights = \n   weights, \", \" Ntrials = NULL, strata = NULL, verbose = verbose, lincomb \n   = lincomb, \", \" selection = selection, control.compute = \n   control.compute, \", \" control.predictor = control.predictor, \n   control.family = control.family, \", \" control.inla = control.inla, \n   control.results = control.results, \", \" control.fixed = control.fixed, \n   control.mode = control.mode, \", \" control.expert = control.expert, \n   control.hazard = control.hazard, \", \" control.lincomb = \n   control.lincomb, control.update = control.update, \", \" control.pardiso \n   = control.pardiso, only.hyperparam = only.hyperparam, \", \" inla.call = \n   inla.call, inla.arg = inla.arg, num.threads = num.threads, \", \" \n   blas.num.threads = blas.num.threads, keep = keep, working.directory = \n   working.directory, \", \" silent = silent, debug = debug)\") \nTime used:\n    Pre = 40.6, Running = 80, Post = 0.765, Total = 121 \nFixed effects:\n              mean    sd 0.025quant 0.5quant 0.975quant   mode kld\n(Intercept) -3.787 0.143     -4.064   -3.789     -3.499 -3.792   0\nMJJ          0.697 0.258      0.184    0.697      1.210  0.697   0\n\nRandom effects:\n  Name\t  Model\n    season IID model\n   S BYM2 model\n   baseline.hazard RW1 model\n\nModel hyperparameters:\n                                  mean       sd 0.025quant 0.5quant 0.975quant\nPrecision for season          4.91e+00 1.92e+00   2.05e+00 4.63e+00   9.46e+00\nPrecision for S               1.73e+09 4.49e+10   3.61e+06 9.66e+07   9.91e+09\nPhi for S                     2.81e-01 2.47e-01   9.00e-03 2.03e-01   8.64e-01\nPrecision for baseline.hazard 2.97e+01 1.19e+01   1.21e+01 2.79e+01   5.81e+01\n                                  mode\nPrecision for season          4.06e+00\nPrecision for S               6.57e+06\nPhi for S                     1.60e-02\nPrecision for baseline.hazard 2.42e+01\n\nExpected number of effective parameters(stdev): 28.64(0.493)\nNumber of equivalent replicates : 651.69 \n\nDeviance Information Criterion (DIC) ...............: 14792.78\nDeviance Information Criterion (DIC, saturated) ....: 9910.78\nEffective number of parameters .....................: 28.93\n\nWatanabe-Akaike information criterion (WAIC) ...: 14791.48\nEffective number of parameters .................: 27.43\n\nMarginal log-Likelihood:  -6871.68 \nCPO and PIT are computed\n\nPosterior marginals for the linear predictor and\n the fitted values are computed\n```\n:::\n:::\n\n\n##### Parameters\n\n###### Posterior distribution summaries\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar_summ_mjj = \ndata.frame(surv_fit_ONI2$summary.fixed %>% \n             dplyr::select(`mean`,`0.5quant`,`mode`,`sd`) %>% \n             dplyr::rename(median = `0.5quant`))\n```\n:::\n\n\n###### HPD intervas\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar_hpd_mjj = \n# intercept(beta_0)\nbind_rows(\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI2$marginals.fixed$`(Intercept)`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI2$marginals.fixed$`(Intercept)`)[2],\n           row.names = \"(Intercept)\"),\n# slope (ONI)\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI2$marginals.fixed$MJJ)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI2$marginals.fixed$MJJ)[2],\n           row.names = \"MJJ\") \n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npar_mjj = bind_cols(par_summ_mjj,par_hpd_mjj)\n```\n:::\n\n\n##### Hyperparameters\n\n###### Posterior distribution summaries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhyper_summ_mjj = \nround(surv_fit_ONI2$summary.hyperpar, 3) %>% \n  dplyr::select(`mean`,`0.5quant`,`mode`,`sd`) %>% \n  dplyr::rename(median = `0.5quant`)\n```\n:::\n\n\n###### HPD intervas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhyper_hpd_mjj = \nbind_rows(\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI2$marginals.hyperpar$`Precision for season`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI2$marginals.hyperpar$`Precision for season`)[2],\n           row.names = \"Precision for season\"),\n\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI2$marginals.hyperpar$`Precision for S`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI2$marginals.hyperpar$`Precision for S`)[2],\n           row.names = \"Precision for S\"),\n\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI2$marginals.hyperpar$`Phi for S`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI2$marginals.hyperpar$`Phi for S`)[2],\n           row.names = \"Phi for S\"),\n\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI2$marginals.hyperpar$`Precision for baseline.hazard`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI2$marginals.hyperpar$`Precision for baseline.hazard`)[2],\n           row.names = \"Precision for baseline.hazard\")\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhyper_mjj = bind_cols(hyper_summ_mjj,hyper_hpd_mjj)\nhyper_mjj\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"mean\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"median\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"mode\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sd\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"HPD_lower\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"HPD_upper\"],\"name\":[6],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"4.911000e+00\",\"2\":\"4.629\",\"3\":\"4.061\",\"4\":\"1.915000e+00\",\"5\":\"1.677938e+00\",\"6\":\"8.671034e+00\",\"_rn_\":\"Precision for season\"},{\"1\":\"1.726114e+09\",\"2\":\"96642125.580\",\"3\":\"6569210.072\",\"4\":\"4.492661e+10\",\"5\":\"7.621925e+03\",\"6\":\"1.470765e+11\",\"_rn_\":\"Precision for S\"},{\"1\":\"2.810000e-01\",\"2\":\"0.203\",\"3\":\"0.016\",\"4\":\"2.470000e-01\",\"5\":\"3.365199e-04\",\"6\":\"7.903439e-01\",\"_rn_\":\"Phi for S\"},{\"1\":\"2.966500e+01\",\"2\":\"27.870\",\"3\":\"24.242\",\"4\":\"1.188300e+01\",\"5\":\"9.756347e+00\",\"6\":\"5.298191e+01\",\"_rn_\":\"Precision for baseline.hazard\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n\n#### Model for  JFM\n\n\n::: {.cell}\n\n```{.r .cell-code}\nform_surv_ONI3 = inla.surv(days, count) ~ 1 + JFM + \n  f(season, model = \"iid\", hyper = list(prec = list(param = c(0.001,0.001))))+\n  f(S, model = \"bym2\", graph = W.pr_dist200,\n    hyper = list(prec = list(param = c(0.001, 0.001)), \n                 phi = list(prior = \"pc\", \n                            param = c(phi.u, phi.alpha),\n                            initial = -3)))\n\n\nsurv_fit_ONI3 = inla(form_surv_ONI3,\n                        data = inla_data_enso,\n                        family = \"coxph\",\n                     control.fixed=list(prec.intercept=1),\n                     control.hazard = list(hyper = list(prec = list(param = c(0.001, 0.001)))),\n                        control.compute=list(dic=TRUE,\n                                             cpo=TRUE,\n                                             waic=TRUE,\n                                             openmp.strategy=\"huge\"))\n\n# saveRDS(surv_fit_ONI3, \"./.models/model_oni3.RDS\")\n```\n:::\n\n\n\n\n\n##### Model summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(surv_fit_ONI3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\n   c(\"inla(formula = cph$formula, family = cph$family, contrasts = \n   contrasts, \", \" data = c(as.list(cph$data), cph$data.list), quantiles = \n   quantiles, \", \" E = cph$E, offset = offset, scale = scale, weights = \n   weights, \", \" Ntrials = NULL, strata = NULL, verbose = verbose, lincomb \n   = lincomb, \", \" selection = selection, control.compute = \n   control.compute, \", \" control.predictor = control.predictor, \n   control.family = control.family, \", \" control.inla = control.inla, \n   control.results = control.results, \", \" control.fixed = control.fixed, \n   control.mode = control.mode, \", \" control.expert = control.expert, \n   control.hazard = control.hazard, \", \" control.lincomb = \n   control.lincomb, control.update = control.update, \", \" control.pardiso \n   = control.pardiso, only.hyperparam = only.hyperparam, \", \" inla.call = \n   inla.call, inla.arg = inla.arg, num.threads = num.threads, \", \" \n   blas.num.threads = blas.num.threads, keep = keep, working.directory = \n   working.directory, \", \" silent = silent, debug = debug)\") \nTime used:\n    Pre = 41.8, Running = 90.9, Post = 1.08, Total = 134 \nFixed effects:\n              mean    sd 0.025quant 0.5quant 0.975quant   mode kld\n(Intercept) -3.759 0.167     -4.079   -3.763     -3.418 -3.769   0\nJFM          0.082 0.160     -0.235    0.081      0.400  0.081   0\n\nRandom effects:\n  Name\t  Model\n    season IID model\n   S BYM2 model\n   baseline.hazard RW1 model\n\nModel hyperparameters:\n                                  mean       sd 0.025quant 0.5quant 0.975quant\nPrecision for season          3.17e+00 1.22e+00   1.33e+00 3.00e+00   6.04e+00\nPrecision for S               2.14e+09 6.53e+10   4.22e+06 1.07e+08   1.19e+10\nPhi for S                     2.81e-01 2.51e-01   9.00e-03 1.98e-01   8.74e-01\nPrecision for baseline.hazard 2.97e+01 1.19e+01   1.21e+01 2.79e+01   5.81e+01\n                                  mode\nPrecision for season          2.65e+00\nPrecision for S               7.94e+06\nPhi for S                     1.60e-02\nPrecision for baseline.hazard 2.43e+01\n\nExpected number of effective parameters(stdev): 28.86(0.457)\nNumber of equivalent replicates : 646.69 \n\nDeviance Information Criterion (DIC) ...............: 14792.94\nDeviance Information Criterion (DIC, saturated) ....: 9910.93\nEffective number of parameters .....................: 29.13\n\nWatanabe-Akaike information criterion (WAIC) ...: 14791.63\nEffective number of parameters .................: 27.62\n\nMarginal log-Likelihood:  -6875.21 \nCPO and PIT are computed\n\nPosterior marginals for the linear predictor and\n the fitted values are computed\n```\n:::\n:::\n\n\n##### Parameters\n\n###### Posterior distribution summaries\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar_summ_jfm = \n data.frame(surv_fit_ONI3$summary.fixed %>% \n             dplyr::select(`mean`,`0.5quant`,`mode`,`sd`) %>% \n             dplyr::rename(median = `0.5quant`))\n```\n:::\n\n\n###### HPD intervas\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar_hpd_jfm = \n# intercept(beta_0)\nbind_rows(\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI3$marginals.fixed$`(Intercept)`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI3$marginals.fixed$`(Intercept)`)[2],\n           row.names = \"(Intercept)\"),\n# slope (ONI)\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI3$marginals.fixed$JFM)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI3$marginals.fixed$JFM)[2],\n           row.names = \"JFM\") \n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npar_jfm = bind_cols(par_summ_jfm,par_hpd_jfm)\n```\n:::\n\n\n##### Hyperparameters\n\n###### Posterior distribution summaries\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhyper_summ_jfm = \nround(surv_fit_ONI3$summary.hyperpar, 3) %>% \n  dplyr::select(`mean`,`0.5quant`,`mode`,`sd`) %>% \n  dplyr::rename(median = `0.5quant`)\n```\n:::\n\n\n###### HPD intervas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhyper_hpd_jfm = \nbind_rows(\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI3$marginals.hyperpar$`Precision for season`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI3$marginals.hyperpar$`Precision for season`)[2],\n           row.names = \"Precision for season\"),\n\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI3$marginals.hyperpar$`Precision for S`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI3$marginals.hyperpar$`Precision for S`)[2],\n           row.names = \"Precision for S\"),\n\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI3$marginals.hyperpar$`Phi for S`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI3$marginals.hyperpar$`Phi for S`)[2],\n           row.names = \"Phi for S\"),\n\ndata.frame(HPD_lower = inla.hpdmarginal(0.95, surv_fit_ONI3$marginals.hyperpar$`Precision for baseline.hazard`)[1],\n           HPD_upper = inla.hpdmarginal(0.95, surv_fit_ONI3$marginals.hyperpar$`Precision for baseline.hazard`)[2],\n           row.names = \"Precision for baseline.hazard\")\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhyper_jfm = bind_cols(hyper_summ_jfm,hyper_hpd_jfm)\n```\n:::\n\n\n\n\n### Full table of Bayesian estimators\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfull_table_oni = bind_rows(\nbind_rows(par_jfm,hyper_jfm) %>% \n  rownames_to_column(\"parameter\") %>%\n  mutate(trimester = \"JFM\") ,\n\nbind_rows(par_mjj,hyper_mjj) %>% \n  rownames_to_column(\"parameter\")%>%\n  mutate(trimester = \"MJJ\"),\n\nbind_rows(par_ond,hyper_ond) %>% \n  rownames_to_column(\"parameter\")%>%\n  mutate(trimester = \"OND\")) %>% \n  relocate(trimester) %>% \n  mutate(mean = ifelse(mean<10,round(mean,2), format(round(mean,2), digits = 3, scientific = T)),\n         \n         median = ifelse(median<10, round(median,2), format(round(median,2), digits = 3, scientific = T)),\n         \n         mode = ifelse(mode<10,round(mode,2), format(round(mode,2), digits = 3, scientific = T)),\n         \n         sd = ifelse(sd<10,round(sd,2),format(round(sd,2), digits = 3, scientific = T)),\n         \n         HPD_lower = ifelse(HPD_lower<10,round(HPD_lower,2), format(round(HPD_lower,2), digits = 3, scientific = T)),\n         \n         HPD_upper = ifelse(HPD_upper<10 ,round(HPD_upper,2), format(round(HPD_upper,2), digits = 3, scientific = T))\n         )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfull_table_oni\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"trimester\"],\"name\":[1],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"parameter\"],\"name\":[2],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"mean\"],\"name\":[3],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"median\"],\"name\":[4],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"mode\"],\"name\":[5],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"sd\"],\"name\":[6],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"HPD_lower\"],\"name\":[7],\"type\":[\"chr\"],\"align\":[\"left\"]},{\"label\":[\"HPD_upper\"],\"name\":[8],\"type\":[\"chr\"],\"align\":[\"left\"]}],\"data\":[{\"1\":\"JFM\",\"2\":\"(Intercept)\",\"3\":\"-3.76\",\"4\":\"-3.76\",\"5\":\"-3.77\",\"6\":\"0.17\",\"7\":\"-4.09\",\"8\":\"-3.43\"},{\"1\":\"JFM\",\"2\":\"JFM\",\"3\":\"0.08\",\"4\":\"0.08\",\"5\":\"0.08\",\"6\":\"0.16\",\"7\":\"-0.24\",\"8\":\"0.4\"},{\"1\":\"JFM\",\"2\":\"Precision for season\",\"3\":\"3.17\",\"4\":\"3\",\"5\":\"2.65\",\"6\":\"1.22\",\"7\":\"1.1\",\"8\":\"5.56\"},{\"1\":\"JFM\",\"2\":\"Precision for S\",\"3\":\"2.14e+09\",\"4\":\"1.07e+08\",\"5\":\"7.94e+06\",\"6\":\"6.53e+10\",\"7\":\"2.02e+03\",\"8\":\"2.32e+11\"},{\"1\":\"JFM\",\"2\":\"Phi for S\",\"3\":\"0.28\",\"4\":\"0.2\",\"5\":\"0.02\",\"6\":\"0.25\",\"7\":\"0\",\"8\":\"0.8\"},{\"1\":\"JFM\",\"2\":\"Precision for baseline.hazard\",\"3\":\"2.97e+01\",\"4\":\"2.79e+01\",\"5\":\"2.43e+01\",\"6\":\"1.19e+01\",\"7\":\"9.78\",\"8\":\"5.30e+01\"},{\"1\":\"MJJ\",\"2\":\"(Intercept)\",\"3\":\"-3.79\",\"4\":\"-3.79\",\"5\":\"-3.79\",\"6\":\"0.14\",\"7\":\"-4.07\",\"8\":\"-3.5\"},{\"1\":\"MJJ\",\"2\":\"MJJ\",\"3\":\"0.7\",\"4\":\"0.7\",\"5\":\"0.7\",\"6\":\"0.26\",\"7\":\"0.18\",\"8\":\"1.21\"},{\"1\":\"MJJ\",\"2\":\"Precision for season\",\"3\":\"4.91\",\"4\":\"4.63\",\"5\":\"4.06\",\"6\":\"1.92\",\"7\":\"1.68\",\"8\":\"8.67\"},{\"1\":\"MJJ\",\"2\":\"Precision for S\",\"3\":\"1.73e+09\",\"4\":\"9.66e+07\",\"5\":\"6.57e+06\",\"6\":\"4.49e+10\",\"7\":\"7.62e+03\",\"8\":\"1.47e+11\"},{\"1\":\"MJJ\",\"2\":\"Phi for S\",\"3\":\"0.28\",\"4\":\"0.2\",\"5\":\"0.02\",\"6\":\"0.25\",\"7\":\"0\",\"8\":\"0.79\"},{\"1\":\"MJJ\",\"2\":\"Precision for baseline.hazard\",\"3\":\"2.97e+01\",\"4\":\"2.79e+01\",\"5\":\"2.42e+01\",\"6\":\"1.19e+01\",\"7\":\"9.76\",\"8\":\"5.30e+01\"},{\"1\":\"OND\",\"2\":\"(Intercept)\",\"3\":\"-3.79\",\"4\":\"-3.79\",\"5\":\"-3.79\",\"6\":\"0.14\",\"7\":\"-4.06\",\"8\":\"-3.52\"},{\"1\":\"OND\",\"2\":\"OND\",\"3\":\"0.32\",\"4\":\"0.32\",\"5\":\"0.32\",\"6\":\"0.1\",\"7\":\"0.13\",\"8\":\"0.52\"},{\"1\":\"OND\",\"2\":\"Precision for season\",\"3\":\"5.8\",\"4\":\"5.47\",\"5\":\"4.8\",\"6\":\"2.26\",\"7\":\"1.99\",\"8\":\"1.02e+01\"},{\"1\":\"OND\",\"2\":\"Precision for S\",\"3\":\"2.16e+09\",\"4\":\"1.11e+08\",\"5\":\"7.94e+06\",\"6\":\"6.36e+10\",\"7\":\"1.88e+03\",\"8\":\"2.30e+11\"},{\"1\":\"OND\",\"2\":\"Phi for S\",\"3\":\"0.28\",\"4\":\"0.2\",\"5\":\"0.01\",\"6\":\"0.25\",\"7\":\"0\",\"8\":\"0.8\"},{\"1\":\"OND\",\"2\":\"Precision for baseline.hazard\",\"3\":\"2.98e+01\",\"4\":\"2.80e+01\",\"5\":\"2.44e+01\",\"6\":\"1.19e+01\",\"7\":\"9.83\",\"8\":\"5.31e+01\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n:::\n\n",
    "supporting": [
      "main_enso_onset_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}